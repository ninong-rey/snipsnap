 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit SnipSnap Profile</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<style>
:root {
  --accent: #fe2c55;
  --bg: #fff;
  --text: #000;
  --muted: #888;
  --light-bg: #f8f8f8;
}
* {box-sizing: border-box;}
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: var(--light-bg);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

/* Modal Styling to mimic the focused edit screen */
.edit-container {
  background: var(--bg);
  max-width: 600px;
  width: 100%;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  margin-top: 50px;
}

/* Header and Close Button */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid #eee;
}
.header h2 {
  font-size: 20px;
  font-weight: 700;
  margin: 0;
}
.close-btn {
  font-size: 24px;
  color: var(--muted);
  cursor: pointer;
}

/* Form Content */
.form-content {
  padding: 30px 20px;
}
.form-group {
  margin-bottom: 25px;
}
.label {
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
  display: block;
}

/* Profile Photo */
.profile-photo-group {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 40px;
}
.avatar-wrapper {
  position: relative;
}
.avatar {
  width: 96px;
  height: 96px;
  border-radius: 50%;
  object-fit: cover;
  border: 1px solid #eee;
}
.edit-icon-wrapper {
  position: absolute;
  bottom: 0;
  right: 0;
  background: var(--bg);
  border-radius: 50%;
  padding: 6px;
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
  cursor: pointer;
}
.edit-icon {
  color: var(--text);
  font-size: 14px;
}

/* Input Fields and Textarea */
.input-area, .textarea-area {
  background: var(--light-bg);
  padding: 12px;
  border-radius: 6px;
  border: 1px solid transparent;
  transition: border-color 0.2s;
}
.input-area:focus-within, .textarea-area:focus-within {
  border-color: #ddd;
}
.input-area input, .textarea-area textarea {
  width: 100%;
  border: none;
  background: none;
  font-size: 16px;
  outline: none;
}
.textarea-area {
  padding-bottom: 30px; /* Space for the character count */
  position: relative;
}

/* Metadata and Helper Text */
.helper-text {
  font-size: 13px;
  color: var(--muted);
  margin-top: 5px;
  line-height: 1.4;
}
.char-count {
  position: absolute;
  bottom: 8px;
  right: 12px;
  font-size: 13px;
  color: var(--muted);
}

/* Footer and Buttons */
.footer-actions {
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  padding: 20px;
  border-top: 1px solid #eee;
}
.btn {
  padding: 10px 25px;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s, opacity 0.2s;
  border: 1px solid #ddd;
}
.btn-cancel {
  background: var(--bg);
  color: var(--text);
}
.btn-save {
  background: var(--accent);
  color: #fff;
  border: none;
  opacity: 0.6; /* Start disabled/faded */
}
.btn-save.enabled {
  opacity: 1;
}

@media (max-width: 650px) {
    .edit-container {
        margin-top: 0;
        border-radius: 0;
        min-height: 100vh;
    }
}
</style>
</head>
<body>

<div class="edit-container">
  <!-- Header -->
  <div class="header">
    <h2>Edit profile</h2>
    <!-- This should typically go back to the profile page -->
    <a href="{{ route('profile') }}" class="close-btn"><i class="fas fa-times"></i></a>
  </div>

  <form method="POST" action="{{ route('profile.update') }}" enctype="multipart/form-data" id="editProfileForm">
    @csrf
    @method('PUT') <!-- Use PUT method for updates in Laravel -->

    <div class="form-content">
      <!-- Profile Photo -->
      <div class="form-group profile-photo-group">
        <span class="label">Profile photo</span>
        <div class="avatar-wrapper" onclick="document.getElementById('avatar_upload').click()">
          <!-- Display current avatar or default -->
          <img id="current_avatar" src="{{ Auth::user()->avatar ? asset('storage/' . Auth::user()->avatar) : asset('default-avatar.png') }}" alt="Avatar" class="avatar">
          <div class="edit-icon-wrapper">
            <i class="fas fa-pencil-alt edit-icon"></i>
          </div>
          <input type="file" id="avatar_upload" name="avatar" style="display: none;" accept="image/*">
        </div>
      </div>

      <!-- Username -->
      <div class="form-group">
        <label for="username" class="label">Username</label>
        <div class="input-area">
          <input type="text" id="username" name="username" value="{{ Auth::user()->username ?? 'snapsnap_user' }}" maxlength="24">
        </div>
        <p class="helper-text">www.snipsnap.com/@<span id="username-link">{{ Auth::user()->username ?? 'snapsnap_user' }}</span></p>
        <p class="helper-text">Usernames can only contain letters, numbers, underscores, and periods. Changing your username will also change your profile link.</p>
      </div>

      <!-- Name (Nickname) -->
      <div class="form-group">
        <label for="name" class="label">Name</label>
        <div class="input-area">
          <input type="text" id="name" name="name" value="{{ Auth::user()->name ?? '' }}" maxlength="30">
        </div>
        <p class="helper-text">Your nickname can only be changed once every 7 days.</p>
      </div>

      <!-- Bio -->
      <div class="form-group">
        <label for="bio" class="label">Bio</label>
        <div class="textarea-area">
          <textarea id="bio" name="bio" rows="4" maxlength="80">{{ Auth::user()->bio ?? '' }}</textarea>
          <span class="char-count"><span id="bio-current-length">{{ strlen(Auth::user()->bio ?? '') }}</span>/80</span>
        </div>
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="footer-actions">
      <a href="{{ route('profile') }}" class="btn btn-cancel">Cancel</a>
      <button type="submit" id="save-btn" class="btn btn-save" disabled>Save</button>
    </div>
  </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('editProfileForm');
        const saveBtn = document.getElementById('save-btn');
        const bioTextarea = document.getElementById('bio');
        const bioCharCount = document.getElementById('bio-current-length');
        const usernameInput = document.getElementById('username');
        const usernameLink = document.getElementById('username-link');
        const avatarUpload = document.getElementById('avatar_upload');
        const currentAvatar = document.getElementById('current_avatar');

        // Store initial values to track changes
        const initialValues = {
            username: usernameInput.value,
            name: document.getElementById('name').value,
            bio: bioTextarea.value,
            avatar: currentAvatar.src // Store the current image src
        };

        // --- Change Tracking Function ---
        function checkChanges() {
            const hasChanges = (
                usernameInput.value !== initialValues.username ||
                document.getElementById('name').value !== initialValues.name ||
                bioTextarea.value !== initialValues.bio ||
                // Note: Checking for new avatar is done by tracking the file input's value
                avatarUpload.files.length > 0
            );

            if (hasChanges) {
                saveBtn.classList.add('enabled');
                saveBtn.disabled = false;
            } else {
                saveBtn.classList.remove('enabled');
                saveBtn.disabled = true;
            }
        }

        // --- Input Event Listeners ---
        // Listen for changes on all relevant form fields
        form.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', checkChanges);
        });

        // Bio character count update
        bioTextarea.addEventListener('input', function() {
            bioCharCount.textContent = this.value.length;
        });

        // Username link preview update
        usernameInput.addEventListener('input', function() {
            usernameLink.textContent = this.value || 'snapsnap_user';
        });

        // Avatar preview when a new file is selected
        avatarUpload.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentAvatar.src = e.target.result;
                    checkChanges(); // Check for changes after file selection
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        // Initial check to set character count
        bioCharCount.textContent = bioTextarea.value.length;
    });
</script>
</body>
</html>
